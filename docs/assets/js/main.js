"use strict";const searchText=document.querySelector(".js-searchtext"),searchBtn=document.querySelector(".js-searchbtn"),animeList=document.querySelector(".js-animelist"),favorites=document.querySelector(".js-favorites"),favsInLocal=document.querySelector(".js-favsinlocal"),resetFavs=document.querySelector(".js-resetfavs");let allResults=[],favoriteAnimes=[];function handleSearchBtn(e){e.preventDefault(),searchText.value.length>=3&&fetch("https://api.jikan.moe/v3/search/anime?q="+searchText.value).then(e=>e.json()).then(e=>{allResults=e.results,getEachResult()})}function getHtmlAnimeList(e,t,s,i){let n=`<li class="js-anime" id="${e}">`;return n+="https://cdn.myanimelist.net/images/qm_50.gif?s=e1ff92a46db617cb83bfc1e205aff620"===t?`<img src="${i}" alt="${s}">`:`<img src="${t}" alt="${s}">`,n+=`<h2 class="js-animetitle animetitle">${s}</h2>`,n+="</li>",n}function getEachResult(){animeList.innerHTML="";for(let e of allResults){const t="https://via.placeholder.com/210x295/567891/891234/?text="+e.type,s=getHtmlAnimeList(e.mal_id,e.image_url,e.title,t);animeList.innerHTML+=s;const i=document.querySelectorAll(".js-anime");for(let e of i)e.addEventListener("click",handleFavorites)}}function getHtmlFavList(e){let t=`<li class="js-favorite" id="${e.id}">`;return t+=`<img src="${e.img}" alt="${e.name}">`,t+=`<h2 class="js-animetitle animetitle">${e.name}</h2>`,t+=`<button class="js-deletebtn deletebtn" id="${e.id}">X</button>`,t+="</li>",t}function printFavorites(){favorites.innerHTML="";for(const e of favoriteAnimes)favorites.innerHTML+=getHtmlFavList(e);const e=document.querySelectorAll(".js-deletebtn");for(const t of e)t.addEventListener("click",deleteEachFavorite)}function handleFavorites(e){let t,s,i=e.currentTarget;const n=document.querySelectorAll(".js-anime");for(const e of favoriteAnimes)e.id===i.id&&(t=e);if(void 0===t){for(const e of n)e.id===i.id&&(i.classList.add("selected"),s=e);favoriteAnimes.push({id:s.id,img:s.childNodes[0].currentSrc,name:s.childNodes[1].innerHTML})}else{const e=favoriteAnimes.indexOf(t);favoriteAnimes.splice(e,1),i.classList.remove("selected")}printFavorites()}function deleteEachFavorite(e){let t,s=e.currentTarget;for(const e of favoriteAnimes)e.id===s.id&&(t=e);if(t.id==t.id){const e=favoriteAnimes.indexOf(t);favoriteAnimes.splice(e,1),printFavorites()}}searchBtn.addEventListener("click",handleSearchBtn),favorites.innerHTML=favoriteAnimes,""!==favorites.innerHTML&&resetFavs.classList.remove("hidden"),localStorage.setItem("favs",JSON.stringify(favoriteAnimes));const savedFavs=localStorage.getItem("favs");function deleteFavAnimeLocal(e){e.target.parentElement.remove()}if(favsInLocal.innerHTML=JSON.parse(savedFavs),""!==favsInLocal.innerHTML){favsInLocal.querySelector(":scope > .js-favorite").querySelector(":scope > .js-deletebtn").addEventListener("click",deleteFavAnimeLocal)}function handleResetFavorites(){favsInLocal.innerHTML="",favorites.innerHTML="",localStorage.removeItem("favs"),resetFavs.classList.add("hidden")}""!==favsInLocal.innerHTML&&resetFavs.classList.remove("hidden"),resetFavs.addEventListener("click",handleResetFavorites);